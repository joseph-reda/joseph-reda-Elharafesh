{"ast":null,"code":"// src/services/booksService.js\nimport { ref, get, child } from \"firebase/database\";\nimport { db } from \"../firebase.js\";\n\n// جلب كل الكتب (للـ Home و Category و Search)\nexport async function fetchBooks() {\n  try {\n    const snapshot = await get(child(ref(db), \"books\"));\n    if (snapshot.exists()) {\n      return Object.entries(snapshot.val()).map(([id, book]) => {\n        // ضمان إن images دايمًا مصفوفة (حتى لو null أو object أو undefined)\n        const images = Array.isArray(book.images) ? book.images : book.images ? Object.values(book.images) : [];\n        return {\n          id,\n          ...book,\n          images // مصفوفة مضمونة\n        };\n      });\n    }\n    return [];\n  } catch (error) {\n    console.error(\"Error fetching all books:\", error);\n    throw error;\n  }\n}\n\n// جلب كتاب واحد بالـ ID (للـ BookDetails) - مع الحماية الكاملة\nexport async function fetchBookById(id) {\n  if (!id || typeof id !== \"string\") {\n    console.warn(\"Invalid book ID:\", id);\n    return null;\n  }\n  try {\n    const snapshot = await get(child(ref(db), `books/${id}`));\n    if (snapshot.exists()) {\n      const data = snapshot.val();\n\n      // الحل السحري: تحويل images إلى array مهما كان شكلها\n      const images = Array.isArray(data.images) ? data.images : data.images && typeof data.images === \"object\" ? Object.values(data.images) : [];\n      return {\n        id,\n        ...data,\n        images // دايمًا array (حتى لو فاضية)\n      };\n    } else {\n      console.log(`Book with ID ${id} not found in database`);\n      return null;\n    }\n  } catch (error) {\n    console.error(\"Error fetching book by ID:\", id, error);\n    throw error;\n  }\n}","map":{"version":3,"names":["ref","get","child","db","fetchBooks","snapshot","exists","Object","entries","val","map","id","book","images","Array","isArray","values","error","console","fetchBookById","warn","data","log"],"sources":["C:/Users/nehru/OneDrive/Desktop/joseph-reda-Elharafesh-master/src/services/booksService.js"],"sourcesContent":["// src/services/booksService.js\r\nimport { ref, get, child } from \"firebase/database\";\r\nimport { db } from \"../firebase.js\";\r\n\r\n// جلب كل الكتب (للـ Home و Category و Search)\r\nexport async function fetchBooks() {\r\n    try {\r\n        const snapshot = await get(child(ref(db), \"books\"));\r\n        if (snapshot.exists()) {\r\n            return Object.entries(snapshot.val()).map(([id, book]) => {\r\n                // ضمان إن images دايمًا مصفوفة (حتى لو null أو object أو undefined)\r\n                const images = Array.isArray(book.images)\r\n                    ? book.images\r\n                    : book.images\r\n                    ? Object.values(book.images)\r\n                    : [];\r\n\r\n                return {\r\n                    id,\r\n                    ...book,\r\n                    images, // مصفوفة مضمونة\r\n                };\r\n            });\r\n        }\r\n        return [];\r\n    } catch (error) {\r\n        console.error(\"Error fetching all books:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// جلب كتاب واحد بالـ ID (للـ BookDetails) - مع الحماية الكاملة\r\nexport async function fetchBookById(id) {\r\n    if (!id || typeof id !== \"string\") {\r\n        console.warn(\"Invalid book ID:\", id);\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        const snapshot = await get(child(ref(db), `books/${id}`));\r\n        if (snapshot.exists()) {\r\n            const data = snapshot.val();\r\n\r\n            // الحل السحري: تحويل images إلى array مهما كان شكلها\r\n            const images = Array.isArray(data.images)\r\n                ? data.images\r\n                : data.images && typeof data.images === \"object\"\r\n                ? Object.values(data.images)\r\n                : [];\r\n\r\n            return {\r\n                id,\r\n                ...data,\r\n                images, // دايمًا array (حتى لو فاضية)\r\n            };\r\n        } else {\r\n            console.log(`Book with ID ${id} not found in database`);\r\n            return null;\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error fetching book by ID:\", id, error);\r\n        throw error;\r\n    }\r\n}"],"mappings":"AAAA;AACA,SAASA,GAAG,EAAEC,GAAG,EAAEC,KAAK,QAAQ,mBAAmB;AACnD,SAASC,EAAE,QAAQ,gBAAgB;;AAEnC;AACA,OAAO,eAAeC,UAAUA,CAAA,EAAG;EAC/B,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMJ,GAAG,CAACC,KAAK,CAACF,GAAG,CAACG,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC;IACnD,IAAIE,QAAQ,CAACC,MAAM,CAAC,CAAC,EAAE;MACnB,OAAOC,MAAM,CAACC,OAAO,CAACH,QAAQ,CAACI,GAAG,CAAC,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAACC,EAAE,EAAEC,IAAI,CAAC,KAAK;QACtD;QACA,MAAMC,MAAM,GAAGC,KAAK,CAACC,OAAO,CAACH,IAAI,CAACC,MAAM,CAAC,GACnCD,IAAI,CAACC,MAAM,GACXD,IAAI,CAACC,MAAM,GACXN,MAAM,CAACS,MAAM,CAACJ,IAAI,CAACC,MAAM,CAAC,GAC1B,EAAE;QAER,OAAO;UACHF,EAAE;UACF,GAAGC,IAAI;UACPC,MAAM,CAAE;QACZ,CAAC;MACL,CAAC,CAAC;IACN;IACA,OAAO,EAAE;EACb,CAAC,CAAC,OAAOI,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;IACjD,MAAMA,KAAK;EACf;AACJ;;AAEA;AACA,OAAO,eAAeE,aAAaA,CAACR,EAAE,EAAE;EACpC,IAAI,CAACA,EAAE,IAAI,OAAOA,EAAE,KAAK,QAAQ,EAAE;IAC/BO,OAAO,CAACE,IAAI,CAAC,kBAAkB,EAAET,EAAE,CAAC;IACpC,OAAO,IAAI;EACf;EAEA,IAAI;IACA,MAAMN,QAAQ,GAAG,MAAMJ,GAAG,CAACC,KAAK,CAACF,GAAG,CAACG,EAAE,CAAC,EAAE,SAASQ,EAAE,EAAE,CAAC,CAAC;IACzD,IAAIN,QAAQ,CAACC,MAAM,CAAC,CAAC,EAAE;MACnB,MAAMe,IAAI,GAAGhB,QAAQ,CAACI,GAAG,CAAC,CAAC;;MAE3B;MACA,MAAMI,MAAM,GAAGC,KAAK,CAACC,OAAO,CAACM,IAAI,CAACR,MAAM,CAAC,GACnCQ,IAAI,CAACR,MAAM,GACXQ,IAAI,CAACR,MAAM,IAAI,OAAOQ,IAAI,CAACR,MAAM,KAAK,QAAQ,GAC9CN,MAAM,CAACS,MAAM,CAACK,IAAI,CAACR,MAAM,CAAC,GAC1B,EAAE;MAER,OAAO;QACHF,EAAE;QACF,GAAGU,IAAI;QACPR,MAAM,CAAE;MACZ,CAAC;IACL,CAAC,MAAM;MACHK,OAAO,CAACI,GAAG,CAAC,gBAAgBX,EAAE,wBAAwB,CAAC;MACvD,OAAO,IAAI;IACf;EACJ,CAAC,CAAC,OAAOM,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEN,EAAE,EAAEM,KAAK,CAAC;IACtD,MAAMA,KAAK;EACf;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}